version: '3.8'

services:
  web:
    labels: 
        - "traefik.enable=true"
        - "traefik.http.routers.web.rule=Host(`testt.int.lflab.org`)"
        - "traefik.http.routers.web.entrypoints=websecure"
    image: nginx:latest
    volumes:
      - ./html:/usr/share/nginx/html
    ports:
      - "8089:80"
    networks:
      - home

  n8n2:
    image: docker.n8n.io/n8nio/n8n
    restart: always
    ports:
      - "5679:5678"
    labels:
        - "traefik.enable=true"
        - "traefik.http.routers.n8n2.rule=Host(`n8n2.int.lflab.org`)"
        - "traefik.http.routers.n8n2-webhook.entrypoints=websecure"
        - "traefik.http.routers.n8n2-webhook.rule=Host(`minchia.lflab.org`) && PathPrefix(`/webhook`)" 
        # && PathPrefix(`/webhook`)"
        - "traefik.http.routers.n8n2.entrypoints=websecure"
    environment:
      - N8N_HOST=n8n2.int.lflab.org
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - NODE_ENV=production
      - WEBHOOK_URL=https://n8n2.int.lflab.org/
    volumes:
      - /home/media/configs/n8n/.n8n:/home/node/.n8n
      - /home/media/configs/n8n/files:/files
    networks:
      - home




networks:
  home:
    external: true